<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style" />
    <title>Tracability</title>
  </head>
  <body>
    <h1>Mangia Mangia</h1>
    <h3>Waist List:</h3>
    <form>
      <input type="text" id="item-name" placeholder="Full Name"/>
      <select id="priority-dropdown">
        <option>Select One</option>
        <option value="Party of 1">Party of 1</option>
        <option value="Party of 2">Party of 2</option>
        <option value="Party of 3">Party of 3</option>
        <option value="Party of 4">Party of 4</option>
        <option value="Party of 5">Party of 5</option>
        <option value="Party of 6">Party of 6</option>
      </select>
      <button>Submit</button>
 <script>
  const wishlistForm = document.getElementById("wishlist-form");
  const priority = document.getElementById("priority-dropdown");
  const itemName = document.getElementById("item-name");
const wishlistSection = document.getElementById("wishlist-section");


const express = require("express");
const path = require("path");

// makes the cards to display the items.
const displayItems = (arr) => {
  console.log(arr);
  while (wishlistSection.firstChild) {
    wishlistSection.removeChild(wishlistSection.firstChild);
  }

  for (let i = 0; i < arr.length; i++) {
    const newItem = document.createElement("div");

    newItem.className = "new-item";

    newItem.innerHTML = `<h1 class='item-title'>${arr[i].name}</h1>
        <p>priority: ${arr[i].priority}</p>
        <button class='delete-btn' value="${arr[i].id}">delete</button>`;

    wishlistSection.appendChild(newItem);

    let deleteBtns = document.getElementsByClassName("delete-btn");

    for (let i = 0; i < deleteBtns.length; i++) {
      deleteBtns[i].addEventListener("click", deleteItem);
    }
  }
};

// Delete an item
const deleteItem = (e) => {
  axios
    .delete(`http://localhost:4000/api/wishlist/${e.target.value}`)
    .then((res) => {
      displayItems(res.data);
    });
};

// Adding a wishlist item
wishlistForm.addEventListener("submit", (e) => {
  e.preventDefault();

  const newItem = {
    name: itemName.value,
    priority: priority.value,
  };

  axios.post("http://localhost:4000/api/wishlist", newItem).then((res) => {
    displayItems(res.data);
  });

  itemName.value = "";
  priority.selectedIndex = 0;
});

    </script>
  </body>
</html>
